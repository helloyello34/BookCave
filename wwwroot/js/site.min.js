// Write your JavaScript code.
console.log("JavaScript loaded. site.min.js used")

$(".dropdown-toggle").on('click', function() {
    console.log("dropdown clicked");
    $(this).parent().toggleClass('open');
    var genreVal = $("ul.genre-menu > li > a.btn.btn-success").text();
    genreVal = genreVal.substring(2, genreVal.end);
    $("#selected-genre-view").text("Genre Selected: " + genreVal);
    $("#genre-list").val(genreVal);
});

$("body").on('click', function(e){
    if(!$("genre-menu").is(e.target)
       && $("genre-menu").has(e.target).length === 0
       && $(".open").has(e.target).length === 0
    ) {
    $(".openclass").removeClass("open");
    var genreVal = $("ul.genre-menu > li > a.btn.btn-success").text();
    genreVal = genreVal.substring(2, genreVal.end);
    $("#selected-genre-view").text("Genre Selected: " + genreVal);
    $("#genre-list").val(genreVal);
}
});

$("ul.genre-menu > li > a").on('click', function() {
    $(this).toggleClass("btn-success btn-default");
});



$(".cartbutton").on("click", function(){
    $.post("/Cart/AddBook?id=" + $(this).prev().text(), function(data, status) {
        console.log("Success");
    }).fail(function(err) {
        alert("You need to be logged in!").fadeTo("slow", 0.5, function(){
            
        }) 
        console.log("Unorthorized bitcheees");  
    });
    $(".alert").show;
});

$(".dropbtn").hover(
    function(){
        $("#dropbtn-span").removeClass("glyphicon-menu-down");
        $("#dropbtn-span").addClass("glyphicon-menu-up");
    },
    function(){
        $(".dropdown-item").hover(
            function(){
                $("#dropbtn-span").removeClass("glyphicon-menu-down");
                $("#dropbtn-span").addClass("glyphicon-menu-up");
            },
            function(){
                $("#dropbtn-span").addClass("glyphicon-menu-down");
                $("#dropbtn-span").removeClass("glyphicon-menu-up");
            }
        )
        $("#dropbtn-span").addClass("glyphicon-menu-down");
        $("#dropbtn-span").removeClass("glyphicon-menu-up");
    }
);

if($(".sum").length)
{
    calcSum();
}

function calcSum (){
    var sumOfAll = 0;
    $(".sum").each(function() {
        var spans = $(this).parent().prev();
        var price = spans.children(".price").text();
        var quantity = spans.children(".quantity").text();
        var sum = parseFloat(quantity) * parseFloat(price);
        $(this).text(sum);
        sumOfAll += parseFloat(sum);
    });
    console.log(sumOfAll);
    $("p#sum-of-all").text(sumOfAll + "$");

}

$("button.addition").on('click', function() {
    var id = $(this).parent().children(".id").text();
    $.post("Cart/AddBook?id=" + id, function(data, status){
    }); 
    $(this).next().text(parseInt($(this).next().text()) + 1);
    calcSum();
});

$("button.subtract").on('click', function() {
    var id = $(this).parent().children(".id").text();
    $.post("Cart/RemoveBook?id=" + id, function(data, status){
    }); 
    $(this).next().next().text($(this).next().next().text()-1);
    if($(this).next().next().text() == "0"){
        $(this).parents(".item-container").next().remove();
        $(this).parents(".item-container").remove();
    }
    calcSum();
});

$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});

window.setTimeout(function() {
    $(".alert").fadeTo(500, 0).slideUp(500, function(){
        $(this).remove(); 
    });
}, 4000);

$(".cartbutton").on('click', function(){
    console.log("hoi");
    var btn = $(this);
    $(btn).toggleClass("btn-primary");
    $(btn).toggleClass("btn-success");
    $(btn).html("Added to cart!");
    setTimeout(function(){
        console.log("time");
        $(btn).toggleClass("btn-primary");
        $(btn).toggleClass("btn-success");
        $(btn).html("Add to Cart");
    }, 2500);
});